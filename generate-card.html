<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>トレカ診断版</title>

<style>
  body {
    font-family: sans-serif;
    background: #f4f4f4;
    padding: 20px;
  }

  .container {
    max-width: 720px;
    margin: 0 auto;
  }

  button {
    padding: 12px;
    width: 100%;
    background: #6c5ce7;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
  }

  #preview img {
    max-width: 100%;
    border-radius: 12px;
    margin-top: 20px;
  }

  canvas {
    display: none;
  }
</style>
</head>

<body>
<div class="container">

<h1>トレカ診断テスト</h1>

<input id="cardName" placeholder="カード名"
       style="width:100%;padding:10px;border-radius:8px;border:1px solid #ccc;margin-bottom:10px;">

<select id="rarity"
        style="width:100%;padding:10px;border-radius:8px;border:1px solid #ccc;margin-bottom:10px;">
  <option value="N">N</option>
  <option value="R">R</option>
  <option value="SR">SR</option>
  <option value="SSR">SSR</option>
  <option value="UR">UR</option>
</select>

<button onclick="generateCard()">カード生成</button>

<canvas id="cardCanvas" width="512" height="768"></canvas>
<div id="preview"></div>

</div>

<script>

async function generateCard() {
  const name = document.getElementById("cardName").value || "無名の戦士";
  const rarity = document.getElementById("rarity").value || "N";

  const imageUrl = await generateCardImage(name, rarity);

  document.getElementById("preview").innerHTML =
    `<img src="${imageUrl}" alt="生成カード">`;
}

async function generateCardImage(name, rarity) {
  console.log("✅ generateCardImage 実行中");

  const canvas = document.getElementById("cardCanvas");
  const ctx = canvas.getContext("2d");
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // 背景（見やすくする）
  ctx.fillStyle = "lime";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  // キャラ画像
  const charImg = new Image();
  charImg.src = "./img/chara.png";
  await new Promise((resolve, reject) => {
    charImg.onload = resolve;
    charImg.onerror = () => reject("chara.png 読み込み失敗");
  });

  // フレーム画像
  const frameImg = new Image();
  frameImg.src = "./img/frame.png";
  await new Promise((resolve, reject) => {
    frameImg.onload = resolve;
    frameImg.onerror = () => reject("frame.png 読み込み失敗");
  });

  // 描画：キャラ → フレーム
  ctx.drawImage(charImg, 0, 0, canvas.width, canvas.height);
  ctx.drawImage(frameImg, 0, 0, canvas.width, canvas.height);

  // テキスト
  ctx.fillStyle = "black";
  ctx.font = "bold 28px sans-serif";
  ctx.textAlign = "center";
  ctx.fillText("FRAME TEST", canvas.width / 2, 60);

  return canvas.toDataURL("image/png");
}


</script>

</body>
</html>
