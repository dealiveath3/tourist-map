<script>
  const map = L.map('map').setView([36.2048, 138.2529], 5);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 18,
    attribution: '© OpenStreetMap contributors'
  }).addTo(map);

  function getColorByCongestion(level) {
    if (level === 'high') return 'red';
    if (level === 'medium') return 'orange';
    return 'blue';
  }

  fetch('congestion_mock_data_47.json')
    .then(response => response.json())
    .then(locations => {
      locations.forEach(loc => {
        const color = getColorByCongestion(loc.congestion);
        const marker = L.circleMarker([loc.lat, loc.lon], {
          radius: 10,
          fillColor: color,
          color: '#000',
          weight: 1,
          opacity: 1,
          fillOpacity: 0.8
        }).addTo(map);

        marker.bindPopup(
          `<strong>${loc.name}</strong><br>混雑：<span style="color:${color}">${loc.congestion}</span>`
        );
      });
    });
</script>
