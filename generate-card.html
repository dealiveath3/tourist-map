<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ãƒˆãƒ¬ã‚«è¨ºæ–­ç‰ˆ</title>

<style>
  body {
    font-family: sans-serif;
    background: #f4f4f4;
    padding: 20px;
  }

  .container {
    max-width: 720px;
    margin: 0 auto;
  }

  button {
    padding: 12px;
    width: 100%;
    background: #6c5ce7;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
  }

  #preview img {
    max-width: 100%;
    border-radius: 12px;
    margin-top: 20px;
  }

  canvas {
    display: none;
  }
</style>
</head>

<body>
<div class="container">

<h1>ãƒˆãƒ¬ã‚«è¨ºæ–­ãƒ†ã‚¹ãƒˆ</h1>

<input id="cardName" placeholder="ã‚«ãƒ¼ãƒ‰å"
       style="width:100%;padding:10px;border-radius:8px;border:1px solid #ccc;margin-bottom:10px;">

<select id="rarity"
        style="width:100%;padding:10px;border-radius:8px;border:1px solid #ccc;margin-bottom:10px;">
  <option value="N">N</option>
  <option value="R">R</option>
  <option value="SR">SR</option>
  <option value="SSR">SSR</option>
  <option value="UR">UR</option>
</select>

<button onclick="generateCard()">ã‚«ãƒ¼ãƒ‰ç”Ÿæˆ</button>

<canvas id="cardCanvas" width="512" height="768"></canvas>
<div id="preview"></div>

</div>

<script>

async function generateCard() {
  const name = document.getElementById("cardName").value || "ç„¡åã®æˆ¦å£«";
  const rarity = document.getElementById("rarity").value || "N";

  const imageUrl = await generateCardImage(name, rarity);

  document.getElementById("preview").innerHTML =
    `<img src="${imageUrl}" alt="ç”Ÿæˆã‚«ãƒ¼ãƒ‰">`;
}

async function generateCardImage(name, rarity) {

  console.log("âœ… generateCardImage å®Ÿè¡Œä¸­");

  const canvas = document.getElementById("cardCanvas");
  const ctx = canvas.getContext("2d");

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // ğŸ”¥ èƒŒæ™¯ã‚’å¡—ã‚‹ï¼ˆå‹•ä½œç¢ºèªç”¨ï¼‰
  ctx.fillStyle = "lime";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  // ğŸ”¥ ã‚­ãƒ£ãƒ©ç”»åƒèª­ã¿è¾¼ã¿
  const charImg = new Image();
  charImg.src = "./img/chara.png";

  await new Promise((resolve, reject) => {
    charImg.onload = resolve;
    charImg.onerror = () => reject("chara.png èª­ã¿è¾¼ã¿å¤±æ•—");
  });

  console.log("âœ… chara.png èª­ã¿è¾¼ã¿æˆåŠŸ", charImg.naturalWidth, charImg.naturalHeight);

  // ğŸ”¥ ã‚­ãƒ£ãƒ©ã ã‘æç”»ï¼ˆãƒ•ãƒ¬ãƒ¼ãƒ ã¯ä¸€åˆ‡ãªã—ï¼‰
  ctx.drawImage(charImg, 0, 0, canvas.width, canvas.height);

  // ğŸ”¥ ãƒ†ã‚­ã‚¹ãƒˆã‚‚æãï¼ˆã“ã‚ŒãŒå‡ºã‚Œã°æç”»ã¯æˆåŠŸï¼‰
  ctx.fillStyle = "black";
  ctx.font = "bold 28px sans-serif";
  ctx.textAlign = "center";
  ctx.fillText("CHAR TEST", canvas.width / 2, 60);

  return canvas.toDataURL("image/png");
}

</script>

</body>
</html>
